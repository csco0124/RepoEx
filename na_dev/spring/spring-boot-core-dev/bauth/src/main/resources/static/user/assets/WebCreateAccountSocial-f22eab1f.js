import{u as D,y as L,r,b as P,j as t,R as _,d as n,T as G,C as H,B as y,$ as C}from"./index-98646e71.js";import{A as J}from"./AppBarGoBack-afc912f2.js";import{c as X,t as Y,a as v}from"./authStyle-a2596f0d.js";import{a as q}from"./Webauthn-6593b58b.js";import{a as w}from"./validateUtil-0f34513f.js";import{T as I}from"./TextField-214db1cb.js";import{C as Q}from"./CardContent-acb39d1a.js";import"./OutlinedInput-0b5b8429.js";import"./useFormControl-5ac6dc89.js";const me=()=>{const z=D(),l=L(),[c,g]=r.useState(""),[x,h]=r.useState(!1),[T,E]=r.useState("이름을 확인해주세요."),[u,A]=r.useState(""),[b,m]=r.useState(!1),[W,d]=r.useState("이메일을 확인해주세요."),[F,V]=r.useState("false"),[U,ee]=r.useState(),[S,B]=r.useState(""),[R,$]=r.useState(!0),{Alert:f,AlertError:k}=P(),o=l.state.id,i=l.state.registType,N=a=>k(a),O=()=>{h(!1),E(""),m(!1),d("")},Z=()=>{C.get(`/auth/api/verify-social/${o}`).then(a=>{if(a.data.error!="OK")return;const e=a.data.data;console.log(e),g(e.nickname),w(e.email)&&A(e.email)})};r.useEffect(()=>{Z()},[]);const K=()=>{O();const a=/^[ㄱ-ㅎ|가-힣]+$/,e=/^[A-Za-z0-9]([-_.]?[A-Za-z0-9])*@[A-Za-z0-9]([-_.]?[A-Za-z0-9])*\.[A-Za-z]{2,3}$/;if(!a.test(c)){N("이름은 한글만 가능합니다.");return}if(!e.test(u)){alert("이메일 양식을 확인해주세요.");return}M()},M=()=>{const a=new FormData;a.append("username",c),a.append("email",u),a.append("using2FA",F),C.post(`/auth/api/${i}/webcreateaccount/${o}`,a).then(e=>{if(console.log(e.data),e.data.error==="OK"){const s=e.data.data;sessionStorage.setItem("identifier",JSON.stringify(e.data.data)),i=="webauthn"&&f({message:"회원가입이 완료되었습니다. 생체인증을 등록해주세요.",onClose:()=>{j(s.userId,o),B(s.userId),$(!1)}}),i=="social"&&f({message:"회원가입이 완료되었습니다.",onClose:()=>{location.href="/oauth2/authorization/"+s.socialName}})}else e.data.error=="USERALREADYEXIST"&&(m(!0),d(e.data.message)),e.data.paramErrors&&(e.data.paramErrors.find(p=>p.field==="username")&&(h(!0),E(e.data.message)),e.data.paramErrors.find(p=>p.field==="email")&&(m(!0),d(e.data.message)))})};function j(a,e){const s={alert:f,userId:a,callbackFn:()=>{z("/user/auth")},verifySocialId:e,secretKey:l.state.secretKey};q(s)}return t.jsxs(_.Fragment,{children:[t.jsx(J,{}),t.jsxs(n,{sx:X,children:[t.jsxs(n,{children:[t.jsxs(G,{variant:"h3",sx:Y,children:["회원가입 정보를",t.jsx("br",{}),"입력해주세요."]}),t.jsx(I,{fullWidth:!0,label:"이름",variant:"outlined",color:"warning",margin:"normal",type:"name",onChange:a=>g(a.target.value),value:c,error:x,helperText:x?T:""}),t.jsx(I,{fullWidth:!0,label:"이메일",variant:"outlined",color:"warning",margin:"normal",type:"email",onChange:a=>A(a.target.value),value:u,error:b,helperText:b?W:""}),U&&t.jsx(H,{sx:{maxWidth:"280px",position:"absolute",zIndex:"10"},children:t.jsx(Q,{sx:{backgroundColor:"#2EAC74",color:"white",fontSize:"13px",textAlign:"left"},children:"최소 8자 이상, 소문자, 대문자, 특수문자 반드시 포함"})})]}),t.jsxs(n,{children:[R&&t.jsx(n,{children:t.jsx(y,{fullWidth:!0,size:"large",onClick:()=>K(),color:"warning",variant:"contained",sx:v,children:"다음"})}),i=="webauthn"&&w(S)&&t.jsx(n,{children:t.jsx(y,{fullWidth:!0,size:"medium",onClick:()=>j(S,o),color:"warning",variant:"contained",sx:v,children:"간편인증 재전송"})})]})]})]})};export{me as default};
